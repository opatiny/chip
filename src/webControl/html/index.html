<html>
    <head>
        <link rel="stylesheet" href="style.css">
        <meta charset="UTF-8">
        <title>Cylinder Control</title>
    </head>
    <body>
        <h1 id="myTitle">Cylinder control page</h1>
        <div style="text-align: center">
            <span id = "epoch"> Time: epoch </span>
        </div>

        <p>Chose the cylinder prototype you will use:
            <!-- Taken from https://www.wufoo.com/html5/elements/5-datalist.html-->
            <select id="datalist">
                <option>cylinderPrototype2</option>
                <option selected="true">cylinderPrototype3</option>
            </select>
            <!-- end-->
        </p>
        <p>Click the <span id="controlButtonSpan">left button</span>  to start cylinder control, click the <span id="stabButtonSpan">right button</span> to run the stabilization algorithm.</p>
        <!-- Creating buttons-->
        <div style="text-align: center">
            <button id="controlButton" class="button" onclick="showDiv('sliderDiv'); hideDiv('stabTextDiv'); opacityOf('stabButton'); opacityOn('controlButton')">Control</button>
            <button id="stabButton" class="button button2" onclick="hideDiv('sliderDiv'); showDiv('stabTextDiv');opacityOn('stabButton'); opacityOf('controlButton')">Stabilisation</button>
        </div>

        <div id="sliderDiv" style="display:none; text-align: center" class="answer_list">
            <p>Move the slider to modify the radius of the circle on which the mass moves, the negative values make the cylinder roll backwards.</p>
            <input type="range" min="-40" max="40" step="1" id="mySlider" style="width: 500px; text-align: center" list="tickmarks">
            <datalist id="tickmarks">
                <option>-40</option>
                <option>-30</option>
                <option>-20</option>
                <option>-10</option>
                <option>0</option>
                <option>10</option>
                <option>20</option>
                <option>30</option>
                <option>40</option>
            </datalist>
            <p>
            <div id="sliderValue"> Current radius: 0 [mm]</div>
            </p>
        </div>

        <div id="stabTextDiv" style="display:none; text-align: center" class="answer_list">
            <p>Place the cylinder on a rigid slope and vary the incline. The cylinder should sway and rebalance up to a certain angle.</p>
        </div>

    </body>


    <script>

        document.getElementById('datalist').addEventListener('input', function(event) {
            console.log(event.target.value);
            sendObjectMessage(ws, {event: 'datalist', value: event.target.value})
        });

        document.getElementById('controlButton').addEventListener('click', function() {
            console.log('ControlButton was pressed');
            sendObjectMessage(ws, {event: 'button', value: 'control'})
        });
        document.getElementById('stabButton').addEventListener('click', function() {
            console.log('StabButton was pressed');
            sendObjectMessage(ws, {event: 'button', value: 'stabilization'})
        });

        document.getElementById('mySlider').addEventListener('input', function(event) {
            console.log(event.target.value);
            document.getElementById('sliderValue').innerHTML= 'Current radius value:' + '\t' + event.target.value + ' [mm]';
            sendObjectMessage(ws, {event: 'radiusSlider', value: event.target.value})
        });

        const ws = new WebSocket(document.location.origin.replace(/^http/,'ws')+'/ws'); // making path of websocket relative using regExp

        ws.onopen = function open() {
            sendObjectMessage(ws, {param1: 'bla', param2: '3 pt'})
        };

        ws.onmessage = function incoming(data) {
            console.log(data);
        };

        window.setInterval( function() {
            document.getElementById('epoch').innerHTML= 'Time in ms:' + '\t' + Date.now();
            sendObjectMessage(ws, new Date());
            console.log(Date.now());
        },10000);


        function sendObjectMessage(ws, value) {
            ws.send(JSON.stringify(value));
        }

        // taken from https://stackoverflow.com/questions/6957443/how-to-display-div-after-click-the-button-in-javascript
        function showDiv(id) {
            document.getElementById(id).style.display = "block";
        }
        //end

        function hideDiv(id) {
            document.getElementById(id).style.display = "none";
        }


        function opacityOn(id) {
            document.getElementById(id).style.opacity = 1;
        }

        function opacityOf(id) {
            document.getElementById(id).style.opacity = 0.5;
        }


    </script>

</html>
